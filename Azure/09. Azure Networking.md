# 09. Azure Networking

### Azure Virtual Network

Azure 가상 네트워크를 사용하면 VM, 웹앱 및 데이터베이스와 같은 Azure 리소스가 서로 통신할 수 있고 인터넷의 사용자 및 온-프레미스 클라이언트 컴퓨터와 통신할 수 있습니다. Azure 네트워크를 다른 Azure 리소스와 연결되는 리소스 집합으로 생각할 수 있다.

Azure Virtual Network는 다음과 같은 주요 네트워킹 기능을 제공합니다.

- 격리 및 구분
- 인터넷 통신
- Azure 리소스 간 통신
- 온-프레미스 리소스와 통신
- 네트워크 트래픽 라우팅
- 네트워크 트래픽 필터링
- 가상 네트워크 연결

#### 격리 및 구분

Virtual Network를 사용하면 격리된 여러 가상 네트워크를 만들 수 있다. 가상 네트워크를 설정하는 경우 공용 또는 개인 IP 주소 범위를 사용하여 개인 IP 주소 공간을 정의한다. 이러한 IP 주소 공간을 서브넷으로 분할하고, 정의된 주소 공간의 일부를 명명된 각 서브넷에 할당할 수 있다. 

#### 인터넷 통신

Azure 리소스를 사용하여 서로 안전하게 통신할 수 있도록 설정하려 한다. 다음 두 가지 방법 중 하나를 수행한다.

- 가상 네트워크 : 가상 네트워크는 VM 뿐만 아니라 Power Apps용 App Service Environment, Azure Kubernetes Service 및 Azure 가상 머신 확장 집합과 같은 다른 Azure 리소스도 연결할 수 있다.
- 서비스 엔드포인트 : 서비스 엔드포인트를 사용하여 Azure SQL Databases 및 스토리지 계정과 같은 다른 Azure 리소스 형식에 연결할 수 있다. 이 방식을 사용하면 여러 Azure 리소스를 가상 네트워크에 연결하여 보안을 개선하고 리소스 간에 최적의 라우팅을 제공할 수 있다.

#### 온-프레미스 리소스와 통신

Azure 가상 네트워크를 사용하면 온-프레미스 환경 및 Azure 구독 내에서 리소스를 함께 연결할 수 있다. 실제로 로컬 환경과 클라우드 환경 모두에 걸쳐 있는 네트워크를 만들 수 있다. 이 연결을 수행하는 세 가지 매커니즘이 있다.

- 지점 및 사이트 간 VPN(가상 사설망) : 이 방법은 반대 방향으로 작동한다는 점을 제외하고 조직 외부의 컴퓨터가 회사 네트워크에 다시 연결하는 VPN 연결과 비슷하다. 이 경우에 클라이언트 컴퓨터는 Azure에 암호화된 VPN 연결을 시작하여 해당 컴퓨터를 Azure 가상 네트워크에 연결한다.
- 사이트 간 VPN : 사이트 간 VPN은 온-프레미스 VPN 디바이스 또는 게이트웨이를 가상 네트워크의 Azure VPN 게이트웨이에 연결한다. 실제로 Azure의 디바이스는 로컬 네트워크에 있는 것으로 표시될 수 있다. 연결은 암호화되고 인터넷에서 작동한다.
- Azure ExpressRoute : 큰 대역폭과 더 높은 수준의 보안이 필요한 환경의 경우 Azure ExpressRoute를 사용하는 것이 가장 좋다. ExpressRoute는 Azure에 대한 전용 프라이빗 연결을 제공한다. 



#### 네트워크 트래픽 라우팅

기본적으로 Azure에서는 연결된 가상 네트워크의 서브넷, 온-프레미스 네트워크 및 인터넷 간에 트래픽을 라우팅한다. 다음과 같이 라우팅을 제어하고 해당 설정을 재정의할 수도 있다.

- 경로 테이블 : 경로 테이블을 사용하면 트래픽을 전달하는 방식에 대한 규칙을 정의할 수 있다. 서브넷 간에 패킷이 라우팅되는 방법을 제어하는 사용자 지정 경로 테이블을 만들 수 있다. 
- BGP(Border Gateway Protocol) : Azure VPN 게이트웨이 또는 ExpressRoute와 함께 작동하여 온-프레미스 BGP 경로를 Azure 가상 네트워크로 전파한다.

#### 네트워크 트래픽 필터링

Azure 가상 네트워크를 사용하면 다음 방법을 사용하여 서브넷 간 트래픽을 필터링할 수 있다.

- 네트워크 보안 그룹 : 네트워크 보안 그룹은 Azure 리소스로서 여러 인바운드 및 아웃바운드 보안 규칙을 포함할 수 있다. 원본 및 대상 IP 주소, 포트 및 프로토콜과 같은 요인에 따라 트래픽을 허용하거나 차단하도록 이러한 규칙을 정의할 수 있다.
- 네트워크 가상 어플라이언스 : 네트워크 가상 어플라이언스는 강화된 네트워크 어플라이언스와 비교될 수 있는 특수한 VM이다. 네트워크 가상 어플라이언스는 방화벽 실행 또는 WAN(광역 네트워크) 최적화 수행과 같은 특정 네트워크 기능을 수행한다.

#### 가상 네트워크 연결

가상 네트워크 *피어링*을사용하여 가상 네트워크를 함께 연결할 수 있다. 피어링을 사용하면 각 가상 네트워크의 리소스가 서로 통신할 수 있다. 이러한 가상 네트워크는 별도 지역에 위치할 수 있으며, Azure를 통해 상호 연결된 글로벌 네트워크를 만들 수 있다.

UDR 은 사용자 정의 라우팅이다. UDR은 Azure 가상 네트워크의 중요한 업데이트이다. UDR을 사용하는 네트워크 관리자는 VNet 간은 물론 VNet 내의 서브넷 간의 라우팅 테이블을 제어할 수 있으므로 네트워크 트래픽 흐름을 더 세밀하게 제어할 수 있다.

![피어링된 가상 네트워크의 로컬 또는 원격 게이트웨이 그림](https://docs.microsoft.com/ko-kr/learn/azure-fundamentals/azure-networking-fundamentals/media/local-or-remote-gateway-in-peered-virual-network.png)



#### Azure VPN Gateway 기본 사항

VPN은 상호 연결된 프라이빗 네트워크의 일종이다. VPN은 다른 네트워크 내에서 암호화된 터널을 사용한다. 일반적으로 둘 이상의 신뢰할 수 있는 사설망을 통해 서로 연결하기 위해 배포된다. 신뢰할 수 없는 네트워크를 통해 이동하는 동안 도청이나 기타 공격을 방지하기 위해 트래픽이 암호화된다.

